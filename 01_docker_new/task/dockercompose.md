:house: [На главную](https://github.com/netology-code/ibdev-homeworks/tree/master/01_docker_new)

# Задание 4. Docker-compose

## Описание задания

Необходимо реализовать запуск подготовленной связки контейнеров с использованием конфигурационного файла docker-compose.yml.

До сих пор вы взаимодействовали с одиночным контейнером, как обособленным элементов для решения своих задач. Теперь вам предстоит поработать с более сложной технологией контейнеризации - запуском подготовленной связки контейнеров (не менее двух). Это отдельные программные сервисы, которые взаимодействуют между собой в рамках единой задачи. 


В этом задании вы:
- загрузите из общедоступного репозитория Docker HUB два готовых образа;
- подготовите два файла, необходимые для реализации проекта: index.html и docker-compose.yml;
- запустите связку из двух контейнеров;
- отработайте базовые команды для управления связкой контейнеров;
- замените в одном из контейнеров исходный файл HTML своим подготовленным экземпляром;
- проведёте анализ полученных результатов.

-----

## Алгоритм выполнения задания

1. Перейдите в правый терминал в рабочий каталог проекта и загрузите два образа из общедоступного репозитория Docker HUB командами поочерёдно: 

- `sudo docker pull nginx`

- `sudo docker pull curlimages/curl`

<img src="https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/sudo%20docker%20pull%20curlimage.png" width="600">

2. Для этого проекта необходимо подготовить два файла в рабочем каталоге проекта. Для этого перейдите в правый терминал и создайте пустые файлы `index.html` и `docker-compose.yml`. Выполните контрольную проверку их наличия в рабочем каталоге (необходимые команды вы уже применяли в предыдущих заданиях).

<img src="https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/kali_6.png" width="600">

3. Сформируйте свой вариант файла титульной страницы для Nginx. Для этого откройте файл `index.html` с помощью текстового редактора `mousepad` или другого на своё усмотрение. Скопируйте подготовленный код:

```
<!DOCTYPE html>
<html>
<head>
 	<title>Hello, Pavel Vorko!</title>
</head>
<body>
 	<h1>Hello, Pavel Vorko!</h1>
 	<p>This is a test page served by Nginx in a Docker container.</p>
</body>
</html>
```

Вставьте этот скрипт в окно текстового редактора открытого файла. Вместо присутствующего в файле Ф.И.О. наберите свои данные. 

Сохраните содержимое файла с помощью комбинации клавиш `Ctrl+S`. Закройте окно текстового редактора и проверьте содержимое соответствующей командой:


4. Для следующего файла вам понадобится информация об IP вашей виртуальной машины Kali Linux для сетевого интерфейса внутренней сети. Для этого выполните команду
`ifconfig`.

<img src="https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/ifconfig_2.png" width="600">

Приступаем к описанию директив конфигурационного файла `docker-compose.yml`, который является ключевым в этом проекте и предназначен для формирования и управления связкой контейнеров.

Откройте файл `docker-compose.yml`, скопируйте подготовленный код и вставьте его в окно открытого файла:

```
version: '3'
services:
# имя сервиса
  nginx:
# используемый образ для первого контейнера
    image: nginx
# пробросить внутренний порт 80 наружу как 8899
    ports:
      - 8899:80
# имя сервиса
  curl:
# используемый образ для второго контейнера
    image: curlimages/curl
# после запуска второго контейнера выполнить указанный запрос к сервису первого контейнера
    command: "curl http://10.0.0.12:8899"
# второму контейнеру дождаться готовности первого
    depends_on:
      - nginx
```

Вместо указанного в файле IP наберите свой, полученный после его проверки командой `ifconfig`. 

**Обратите внимание!** Необходимо строго соблюдать отступы, приведённые в строках директив. 

5. Перейдите в левый терминал и запустите связку контейнеров, управляемую конфигурационным файлом `docker-compose.yml` командой
`sudo docker-compose up`.

![](https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/sudo%20docker-compose%20up.png)

Внимательно изучите вывод информации в контейнере. Обратите внимание, что первый и второй контейнеры помечены разным цветом: 
- коричневым - `nginx`,
- синим - `curl`.

Видно, что на отправленный запрос `Curl` к Nginx, запрашивающий его титульную страницу, была возвращена стандартная страница Nginx в формате исходного кода HTML.

У вас имеется возможность видеть эту страницу в браузере. Переключитесь на второй рабочий стол (у Kali Linux их четыре), откройте браузер Mozilla Firefox. Впишите в адресную строку браузера адрес из файла `docker-compose.yml`, по которому подключается Curl с вашим IP.  результате вы получите стандартную титульную страницу Nginx.

<img src="https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/Nginx_1.png" width="700">

6. Переключитесь снова на первый рабочий стол с терминалами. Перейдите в левый терминал активных контейнеров и прервите их работу комбинацией клавиш `Ctrl+C`.  

![](https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/Nginx_2.png)

Перейдите в правый терминал и проверьте наличие контейнеров и их состояние с помощью применяемой ранее команды.

![](https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/Nginx_3.png)

Вы увидете два неактивных контейнера.

7. Далее проделаем интересный и полезный трюк - заменим в контейнере nginx титульную страницу на подготовленный ранее экземпляр `index.html` командой
`sudo docker cp index.html docker_nginx_1:/usr/share/nginx/html/index.html`.

Перейдите в левый терминал и повторите запуск контейнеров командой
`sudo docker-compose up`.

![](https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/sudo%20docker-compose%20up_2.png)

В результате вы увидите новый код титульной страницы Nginx, который содержит ваше ФИО из подготовленной страницы для проекта.

Чтобы окончательно убедиться и подтвердить замену титульной страницы, переключитесь на второй рабочий стол, где открыт браузер Mozilla Firefox с адресом из контейнера и обновите страницу.

<img src="https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/hello.png" width="700">

Если вы видите приветствие с вашим ФИО, значит всё сделано правильно. Вы успешно выполнили это непростое практическое упражнение. 

8. Вам осталось завершить работу активной связки контейнеров. Обратите внимание, что в левом терминале контейнер выводит информацию обо всех запросах к Nginx.

Переключитесь на первый рабочий стол с терминалами. Перейдите в правый терминал основной системы и завершите работу связки активных контейнеров одной командой
`sudo docker-compose down`.

<img src="https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/sudo%20docker-compose%20down.png" width="400">

В левом терминале отметьте завершение работы контейнеров и возврат в командную оболочку основной системы.

![](https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/sudo%20docker-compose%20down_2.png)

Проверьте наличие контейнеров в основной системе и убедитесь, что они отсутствуют и были удалены после остановки контейнеров через docker-compose с помощью команды, которую вы применяли ранее.

<img src="https://github.com/netology-code/ibdev-homeworks/blob/master/01_docker_new/pic/sudo%20docker-compose%20down_3.png" width="700">

Отлично! Вы успешно завершили работу с этим заданием.

-----

## Подведём итоги

В этом задании вы:

- загрузили из общедоступного репозитория Docker HUB два готовых образа;
- подготовили два файла, необходимые для реализации проекта: index.html и docker-compose.yml;
- запустили связку из двух контейнеров;
- отработали базовые команды для управления связкой контейнеров;
- заменили в одном из контейнеров исходный файл HTML своим подготовленным экземпляром;
- провели анализ полученных результатов.

-----

:house: [На главную](https://github.com/netology-code/ibdev-homeworks/tree/master/01_docker_new)
