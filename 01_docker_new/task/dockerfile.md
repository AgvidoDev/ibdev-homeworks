## Задание 3. Dockerfile

### Описание задания

Вы запустили контейнер на основе готового образа из общедоступного репозитория Docker HUB и вручную выполнили отдельные команды для решения простых задач. Далее необходимо подготовить образ, который будет содержать заложенные директивы. Они будут автоматически выполнены при запуске контейнера. Директивы прописываются в специальном конфигурационном файле Dockerfile.

В этом задании вы:
- подготовите файл скрипта с командами, которые будут автоматически выполняться в контейнере bash,
- подготовите конфигурационный файл Dockerfile с директивами для сборки преднастроенного образа,
- выполните сборку образа, который будет включать преднастроенный сценарий для контейнера,
- запустите контейнер на основе преднастроенного образа и получите результаты выполнения команд после автоматического запуска скрипта,
- вручную запустите этот же скрипт в командной оболочке основной системы Kali Linux,
- сравните полученные результаты из контейнера и основной системы.

-----

### Алгоритм выполнения задания

**1. Создайте Dockerfile и настройте для него права.**

Откройте два терминала или разделите открытый терминал на две половины по вертикали. В обоих терминалах перейдите в ранее подготовленный рабочий каталог проекта. 

Левый терминал оставьте под запуск и работу контейнера. Перейдите в правый терминал, где вам предстоит выполнить все сопутствующие операции для последующего  запуска контейнера в левом терминале.

Создайте пустой файл Dockerfile командой
`touch Dockerfile`.

Далее создайте пустой файл скрипта, назначив ему имя на своё усмотрение из допустимых с помощью команды
`touch my_bash_1.sh`,

где `my_bash_1.sh` - назначенное имя для скрипта.

Проверьте наличие и права созданных файлов командой
`ls -l`.

**Обратите внимание!** Файл скрипта не имеет прав на выполнение. Это означает, что скрипт нельзя будет запустить и выполнить. 

Предоставьте скрипту права на выполнение только для владельца файла (для себя) с помощью команды
`sudo chmod u+x my_bash_1.sh`,

где:
- `chmod` - предоставить разрешения,
- `u` - только владельцу файла,
- `+x` - на выполнение файла (запуск скрипта).

Повторно проверьте назначенные права для скрипта: 
`ls -l`.

Отлично! Необходимые права назначены.

**2. Добавьте скрипт в созданный файл и проверьте работу скрипта.**

Откройте файл скрипта с помощью текстового редактора `mousepad`, который предустановлен на Kali Linux:
`mousepad my_bash_1.sh`.

На Ubuntu можете воспользоваться текстовым редактором `nano`.

Впишите команды, которые будут выполнены при запуске скрипта. Скопируйте подготовленный код для скрипта с командами и комментариями и вставьте в открытое в текстовом редакторе окно файла скрипта:

```
# определяем переменную для ФИО
my_name='Pavel Vorko'
# вставляем пустую строку
echo ''
# выводим версию и номер релиза ОС
cat /etc/*release*
# вставляем пустую строку
echo ''
# выводим ФИО
echo ${my_name}
# выводим текущую дату и время
date +'%d/%m/%Y %H:%M:%S'
```

Сохраните содержимое файла через комбинацию
`CTRL+S`.

Закройте окно текстового редактора с файлом скрипта и проверьте содержимое скрипта командой
`cat my_bash_1.sh`.

Проверьте работу скрипта непосредственно в командной оболочке Kali Linux в текущем правом терминале. Запустите скрипт 
`./my_bash_1.sh`.

Если скрипт отработал корректно, он выведет запрашиваемую для отчёта информацию по основной системе Kali Linux.

**3. Подготовьте конфигурационный файл для сборки преднастроенного образа Bash.**

Откройте файл Dockerfile с помощью текстового редактора `mousepad` или любого другого на своё усмотрение. Скопируйте подготовленный код c комментариями:

```
# создать контейнер на основе образа
FROM bash
# загрузить в корневой каталог контейнера файл
COPY my_bash_1.sh /
# назначить файлу права на выполнение
RUN chmod +x my_bash_1.sh
# после запуска контейнера запустить в
# командной оболочке контейнера исполняемый файл
CMD ["./my_bash_1.sh"]
```

Вставьте текст скрипта в окно текстового редактора открытого файла. Сохраните содержимое файла через комбинацию клавиш `CTRL+S`.

Закройте окно текстового редактора и проверьте содержимое соответствующей командой:

Ваш Dockerfile с директивами для создания преднастроенного образа готов.

**4. Выполните сборку образа.**

Файл скрипта для выполнения команд в контейнере был подготовлен ранее. Все необходимые файлы для сборки образа присутствуют в рабочем каталоге проекта.

Запустите сборку образа командой
`sudo docker build -t image_bash_1 .`,

где:
- `build` - запустить сборку образа,
- `-t` - присвоить новое имя образу,
- `image_bash_1` - имя образа,
- `.` - использовать текущий каталог.

Проверьте наличие подготовленного образа в системе соответствующей командой:

**5. Запустите контейнер на основе образа.**

Настал ответственный момент запуска контейнера на основе подготовленного образа `image_bash_1.`

Чтобы сделать компактный скриншот для отчёта, уменьшите окно терминала до приемлемого размера. Перейдите в левый терминал и запустите контейнер с опцией автоматического удаления его после завершения работы командой
`sudo docker run –rm image_bash_1`.

После запуска переключитесь в правый терминал и запустите скрипт
`./my_bash_1.sh`.

Проверьте соответствующей командой оставшиеся в системе контейнеры после завершения их работы:

Если таковых не обнаружено, то всё работает именно так, как вы настроили. Поздравляем!

Результаты в терминалах без всяких сомнений подтверждают работу скрипта в контейнере в левом терминале и в основной системе виртуальной машины Kali Linux в правом терминале.

-----

### Подведём итоги

В этом задании вы:

- подготовили файл скрипта с командами, которые будут автоматически выполняться в контейнере bash,
- подготовили конфигурационный файл Dockerfile с директивами для сборки преднастроенного образа,
- выполнили сборку образа, который будет включать преднастроенный сценарий для контейнера,
- запустили контейнер на основе преднастроенного образа и получили результаты выполнения команд после автоматического запуска скрипта,
- вручную запустили этот же скрипт в командной оболочке основной системы Kali Linux,
- сравнили полученные результаты из контейнера и основной системы.

